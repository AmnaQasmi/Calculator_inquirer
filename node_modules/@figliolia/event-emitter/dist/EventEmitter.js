"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EventEmitter = void 0;
const Indexer_1 = require("./Indexer");
/**
 * Event Emitter
 *
 * A low-code solution for type-safe event emitting outside of
 * the global scope
 *
 * ```typescript
 * const emitter = new EventEmitter<{
 *   "event-1": number[],
 *   "event-2": Map<string, () => {}>
 * }>();
 *
 * // Subscribe to permitted events
 * const ID1 = emitter.on("event-1", list => {});
 * const ID2 = emitter.on("event-2", map => {});
 *
 * // Emit permitted events
 * emitter.emit("event-1", [1, 2, 3]);
 * emitter.emit("event-2", new Map());
 *
 * // Clean up listeners to events
 *
 * emitter.off("event-1", ID1);
 * emitter.off("event-2", ID2);
 * ```
 */
class EventEmitter extends Map {
    /**
     * On
     *
     * Registers an event handler on the `EventEmitter`. Your handler will
     * be invoked each time `EventEmitter.emit()` is called with an event
     * matching your handler.
     *
     * ```typescript
     * const emitter = new EventEmitter();
     *
     * const listenerID = emitter.on("event-1", event => {
     *   console.log("event-1", event);
     * });
     *
     * // Cleaning up
     * emitter.off("event-1", listenerID);
     * ```
     */
    on(event, listener) {
        const index = this.get(event) || new Indexer_1.Indexer();
        const ID = index.register(listener);
        this.set(event, index);
        return ID;
    }
    /**
     * Off
     *
     * Removes an event handler from the `EventEmitter` given an
     * event and lister ID
     */
    off(event, ID) {
        const index = this.get(event);
        if (index) {
            return index.delete(ID);
        }
    }
    /**
     * Emit
     *
     * Streams an event to all subscribers
     */
    emit(event, param) {
        const index = this.get(event);
        if (index) {
            index.execute(param);
        }
    }
    /**
     * Emit
     *
     * Streams an event to all subscribers handling
     * asynchronous subscriptions as blocking tasks
     */
    async emitBlocking(event, param) {
        const index = this.get(event);
        if (index) {
            await index.executeBlocking(param);
        }
    }
}
exports.EventEmitter = EventEmitter;
